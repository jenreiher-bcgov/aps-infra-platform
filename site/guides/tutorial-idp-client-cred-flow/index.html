
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="BC Gov API Services">
      
      
      
      
        <link rel="prev" href="../prom-query/">
      
      
        <link rel="next" href="../../portal-use-cases/access/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.3">
    
    
      
        <title>Protecting an API with OAuth2 Client Credential Flow - APS Infra Platform</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c4a75a56.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#protecting-an-api-with-oauth2-client-credential-flow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="APS Infra Platform" class="md-header__button md-logo" aria-label="APS Infra Platform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            APS Infra Platform
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Protecting an API with OAuth2 Client Credential Flow
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
      </form>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/jenreiher-bcgov/aps-infra-platform" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="APS Infra Platform" class="md-nav__button md-logo" aria-label="APS Infra Platform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    APS Infra Platform
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jenreiher-bcgov/aps-infra-platform" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../personas/" class="md-nav__link">
        Personas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../presentations/" class="md-nav__link">
        Presentations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Gateway
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Gateway
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/AVAILABLE-PLUGINS/" class="md-nav__link">
        Supported Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/COMMON-CONFIG/" class="md-nav__link">
        Common Controls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/SSL/" class="md-nav__link">
        SSL Termination
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          Plugins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Plugins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/acl/" class="md-nav__link">
        Access Control List
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/cors/" class="md-nav__link">
        Cross-origin Resource Sharing (CORS)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/gwa-ip-anonymity/" class="md-nav__link">
        GWA IP Anonymity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/jwt-keycloak/" class="md-nav__link">
        JWT Keycloak
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/key-auth/" class="md-nav__link">
        Key Auth
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/kong-upstream-auth-basic/" class="md-nav__link">
        Kong Upstream Auth Basic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/kong-upstream-jwt/" class="md-nav__link">
        Kong Upstream JWT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/oidc-consumer/" class="md-nav__link">
        OIDC Consumer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/oidc/" class="md-nav__link">
        OIDC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/proxy-cache/" class="md-nav__link">
        Proxy Cache
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/rate-limiting/" class="md-nav__link">
        Rate Limiting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/request-transformer/" class="md-nav__link">
        Request Transformer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/plugins/waiting-queue/" class="md-nav__link">
        Waiting Queue
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro-signed-jwt-pubkey/" class="md-nav__link">
        Signed JWT with Certificate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro-signed-jwt/" class="md-nav__link">
        Signed JWT with Hosted JWKS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../keycloak-rbac/" class="md-nav__link">
        OIDC and RBAC Protection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../owner-journey/" class="md-nav__link">
        API Provider User Journey
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../prom-query/" class="md-nav__link">
        Query Kong Metrics Using Service Account
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Protecting an API with OAuth2 Client Credential Flow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Protecting an API with OAuth2 Client Credential Flow
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-configuring-an-api-on-the-kong-gateway" class="md-nav__link">
    1. Configuring an API on the Kong Gateway
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-granting-access-to-the-idp" class="md-nav__link">
    2. Granting Access to the IdP
  </a>
  
    <nav class="md-nav" aria-label="2. Granting Access to the IdP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-idp" class="md-nav__link">
    Custom IdP
  </a>
  
    <nav class="md-nav" aria-label="Custom IdP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-prerequisites" class="md-nav__link">
    a) Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-setup-the-authorization-profile" class="md-nav__link">
    b) Setup the Authorization Profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-link-the-authorization-profile-to-the-product" class="md-nav__link">
    c) Link the Authorization Profile to the Product
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-update-your-gateway-configuration-with-the-plugin" class="md-nav__link">
    d) Update your Gateway Configuration with the Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-optional-configuration" class="md-nav__link">
    e) Optional Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shared-idp" class="md-nav__link">
    Shared IdP
  </a>
  
    <nav class="md-nav" aria-label="Shared IdP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-setup-the-authorization-profile" class="md-nav__link">
    a) Setup the Authorization Profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-link-the-authorization-profile-to-the-product" class="md-nav__link">
    b) Link the Authorization Profile to the Product
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-update-your-gateway-configuration-with-the-plugin" class="md-nav__link">
    c) Update your Gateway Configuration with the Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-optional-configuration" class="md-nav__link">
    d) Optional Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-client-requesting-access" class="md-nav__link">
    3. Client Requesting Access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-provider-approving-access" class="md-nav__link">
    4. Provider Approving Access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-client-retrieving-the-access-token" class="md-nav__link">
    5. Client Retrieving the Access Token
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-client-calling-the-api" class="md-nav__link">
    6. Client Calling the API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-gateway-proxying-to-upstream" class="md-nav__link">
    7. Gateway Proxying to Upstream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variations" class="md-nav__link">
    Variations
  </a>
  
    <nav class="md-nav" aria-label="Variations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signed-jwt" class="md-nav__link">
    Signed JWT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Portal use cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Portal use cases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../portal-use-cases/access/" class="md-nav__link">
        4. Request/Approve Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../portal-use-cases/consumer-maintenance/" class="md-nav__link">
        5. Consumer Maintenance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../portal-use-cases/create-service-account/" class="md-nav__link">
        2. Create Service Account
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../portal-use-cases/login/" class="md-nav__link">
        1. Login
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../portal-use-cases/switch-namespace/" class="md-nav__link">
        3. Switch Namespace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../portal-use-cases/websequencediagrams/" class="md-nav__link">
        Web Sequence Diagrams
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Releases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/" class="md-nav__link">
        Releases
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/2021-jun/" class="md-nav__link">
        2021-JUN Beta Release
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/2022-aug/" class="md-nav__link">
        2022-AUG Release 1.2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/2022-may/" class="md-nav__link">
        2022-MAY Release 1.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/2022-oct-1.2.5/" class="md-nav__link">
        2022-OCT Release 1.2.5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/2022-sept-1.2.4/" class="md-nav__link">
        2022-SEPT Release 1.2.4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/2022-sept/" class="md-nav__link">
        2022-SEPT Release 1.2.3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/2023-jan-1.2.6/" class="md-nav__link">
        2023-JAN Release 1.2.6
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/2023-jun-1.2.12/" class="md-nav__link">
        2023-JUN Release 1.2.12
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/2023-mar-1.2.11/" class="md-nav__link">
        2023-MAR Release 1.2.11
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-configuring-an-api-on-the-kong-gateway" class="md-nav__link">
    1. Configuring an API on the Kong Gateway
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-granting-access-to-the-idp" class="md-nav__link">
    2. Granting Access to the IdP
  </a>
  
    <nav class="md-nav" aria-label="2. Granting Access to the IdP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-idp" class="md-nav__link">
    Custom IdP
  </a>
  
    <nav class="md-nav" aria-label="Custom IdP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-prerequisites" class="md-nav__link">
    a) Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-setup-the-authorization-profile" class="md-nav__link">
    b) Setup the Authorization Profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-link-the-authorization-profile-to-the-product" class="md-nav__link">
    c) Link the Authorization Profile to the Product
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-update-your-gateway-configuration-with-the-plugin" class="md-nav__link">
    d) Update your Gateway Configuration with the Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e-optional-configuration" class="md-nav__link">
    e) Optional Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shared-idp" class="md-nav__link">
    Shared IdP
  </a>
  
    <nav class="md-nav" aria-label="Shared IdP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-setup-the-authorization-profile" class="md-nav__link">
    a) Setup the Authorization Profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-link-the-authorization-profile-to-the-product" class="md-nav__link">
    b) Link the Authorization Profile to the Product
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-update-your-gateway-configuration-with-the-plugin" class="md-nav__link">
    c) Update your Gateway Configuration with the Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-optional-configuration" class="md-nav__link">
    d) Optional Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-client-requesting-access" class="md-nav__link">
    3. Client Requesting Access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-provider-approving-access" class="md-nav__link">
    4. Provider Approving Access
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-client-retrieving-the-access-token" class="md-nav__link">
    5. Client Retrieving the Access Token
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-client-calling-the-api" class="md-nav__link">
    6. Client Calling the API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-gateway-proxying-to-upstream" class="md-nav__link">
    7. Gateway Proxying to Upstream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variations" class="md-nav__link">
    Variations
  </a>
  
    <nav class="md-nav" aria-label="Variations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signed-jwt" class="md-nav__link">
    Signed JWT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/jenreiher-bcgov/aps-infra-platform/edit/main/docs/guides/tutorial-idp-client-cred-flow.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="protecting-an-api-with-oauth2-client-credential-flow">Protecting an API with OAuth2 Client Credential Flow<a class="headerlink" href="#protecting-an-api-with-oauth2-client-credential-flow" title="Permanent link">&para;</a></h1>
<p>Steps for protecting and calling an API using the OAuth2 Client Credential Grant.</p>
<ol>
<li>Configuring an API on the Kong Gateway</li>
<li>Granting Access to the IdP</li>
<li>Client Requesting Access</li>
<li>Provider Approving Access</li>
<li>Client Retrieving the Access Token</li>
<li>Client Calling an API</li>
<li>Gateway Proxying to Upstream</li>
</ol>
<p><img alt="alt text" src="../assets/oauth2.png" title="Protecting an API" /></p>
<h2 id="1-configuring-an-api-on-the-kong-gateway">1. Configuring an API on the Kong Gateway<a class="headerlink" href="#1-configuring-an-api-on-the-kong-gateway" title="Permanent link">&para;</a></h2>
<p>The API Provider User Journey document provides the steps to enable a new API on the Kong Gateway. It will walk you through the creation of a new Namespace, and a Service Account that can be used to configure the Kong Gateway and the Authorization Profile described in step 2.</p>
<p>Once the API is working on the Gateway, you can then define a Product, which can be made available on the API Services Portal Directory.</p>
<h2 id="2-granting-access-to-the-idp">2. Granting Access to the IdP<a class="headerlink" href="#2-granting-access-to-the-idp" title="Permanent link">&para;</a></h2>
<h3 id="custom-idp">Custom IdP<a class="headerlink" href="#custom-idp" title="Permanent link">&para;</a></h3>
<h4 id="a-prerequisites">a) Prerequisites<a class="headerlink" href="#a-prerequisites" title="Permanent link">&para;</a></h4>
<p>Before the Portal can be configured, a new set of credentials must be created on the IdP. For this tutorial, we will include the steps when Keycloak is the IdP.</p>
<p><strong>Create a new Client on the IdP</strong></p>
<p>Create a new client with Access Type <code>confidential</code>. All flows except <code>Service Accounts</code> should be turned off.</p>
<p>Make a note of the <code>Client ID</code> and <code>Client Secret</code> , they will be used when the Portal <code>Authorization Profile</code> is created.</p>
<p>The <code>Full Scope Allowed</code> can be turned off and the <code>realm-management</code> client roles for <code>manage-clients</code> and <code>manage-users</code> should be added.</p>
<p>Add the <code>manage-clients</code> and <code>manage-users</code> client roles to the <code>Service Account Roles</code>.</p>
<h4 id="b-setup-the-authorization-profile">b) Setup the Authorization Profile<a class="headerlink" href="#b-setup-the-authorization-profile" title="Permanent link">&para;</a></h4>
<p>A credential with <code>CredentialIssuer.Admin</code> is required to update Authorization Profiles (<code>CredentialIssuer</code>).</p>
<p>Authorization Profiles can be setup either via the Portal or by using a Service Account with the Portal Directory API.</p>
<p>Update the below <code>CredentialIssuer</code> to include the environment details and the Scopes and Roles setup for authorization.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CredentialIssuer</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Resource Server Example</span>
<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$NS</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Authorization Profile for protecting Ministry of XYZ</span>
<span class="nt">flow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">client-credentials</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
<span class="nt">authPlugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jwt-keycloak</span>
<span class="nt">clientAuthenticator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">client-secret</span>
<span class="nt">clientRoles</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">clientMappers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audience</span>
<span class="w">    </span><span class="nt">defaultValue</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">availableScopes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">Function1/read</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Function2/*</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Function3/write</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Function3/read</span><span class="p p-Indicator">]</span>
<span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your-username&gt;</span>
<span class="nt">environmentDetails</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod</span>
<span class="w">    </span><span class="nt">issuerUrl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://auth-issuer</span>
<span class="w">    </span><span class="nt">clientId</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testapp-client</span>
<span class="w">    </span><span class="nt">clientRegistration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">managed</span>
<span class="w">    </span><span class="nt">clientSecret</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
<h4 id="c-link-the-authorization-profile-to-the-product">c) Link the Authorization Profile to the Product<a class="headerlink" href="#c-link-the-authorization-profile-to-the-product" title="Permanent link">&para;</a></h4>
<p>Before making the API available on the Directory, the API should be configured with a plugin for protecting access. To do this, an API Provider can edit the Product details to select <code>Oauth2 Client Credential Flow</code> and the newly created Authorization Profile.</p>
<h4 id="d-update-your-gateway-configuration-with-the-plugin">d) Update your Gateway Configuration with the Plugin<a class="headerlink" href="#d-update-your-gateway-configuration-with-the-plugin" title="Permanent link">&para;</a></h4>
<p>Update your Gateway Configuration to include the <code>jwt-keycloak</code> plugin.</p>
<blockquote>
<p>HINT: When you configure the Product Environment, a <code>Plugin Template</code> will be displayed - this can be a starting point for protecting your API on the Gateway.</p>
</blockquote>
<p>Finally, from the Portal, <code>enable</code> the Environment to make it available on the API Directory.</p>
<h4 id="e-optional-configuration">e) Optional Configuration<a class="headerlink" href="#e-optional-configuration" title="Permanent link">&para;</a></h4>
<p><strong>Scopes</strong></p>
<p>If you have Client Scopes that you want to have controlled by the Portal, add them to the Realm's <code>Client Scopes</code> and <code>Default Client Scopes</code> on the IdP.</p>
<p>Update the <code>CredentialIssuer</code> record above to match the <code>availableScopes</code> with the ones added on the IdP.</p>
<p><strong>Roles</strong></p>
<p>If you have Roles that you want to have controlled by the Portal, add them to the Client's <code>Roles</code>.</p>
<p>Update the <code>CredentialIssuer</code> record above to match the <code>clientRoles</code> with the ones added on the IdP.</p>
<p><strong>Client Mappers</strong></p>
<p>The <code>audience</code> is an optional mapper that can be added to a Client.</p>
<p>The IdP needs to have a policy that allows Audience to be added as a Protocol Mapper to the client.</p>
<p>In Keycloak, this is updated under the Realm's <code>Client Registration</code> -&gt; <code>Client Registration Policies</code>.</p>
<p>Edit the Authenticated Access Policies -&gt; Allowed Protocol Mapper Types to include the <code>oidc-audience-mapper</code>.</p>
<p><strong>UMA2 Authorization Resources</strong></p>
<p>If you want to use the Authorization services, then set <code>Authorization Enabled</code> to <code>ON</code> for the Client on the IdP. You will also want to set the <code>Decision Strategy</code> to <code>Affirmative</code>.</p>
<p>Update the following <code>CredentialIssuer</code> attributes:</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>  resourceType: &quot;&quot;
  resourceAccessScope: &quot;&quot;
  resourceScopes: []
</code></pre></div></td></tr></table></div>
<ul>
<li><code>resourceType</code>: The Resource Type of the resources that will be managed (required)</li>
<li><code>resourceScopes</code>: A list of the Authorization Scopes managed for the particular Resources (required)</li>
<li><code>resourceAccessScope</code>: Used in the case where the Resource Server owns all the resources, a user must have the <code>resourceAccessScope</code> assigned in order to be allowed to manage the access. If it is not set, then the user has to be the resource owner in order to manage access.</li>
</ul>
<blockquote>
<p><code>resourceAccessScope</code> - The API Services Portal has not completed the implementation for the scenario where the User is the Resource Owner (<code>resourceAccessScope</code> is left blank). It uses the <code>Token Exchange</code> capability but it's an optional service available on Keycloak and has numerous caveats around it. Please contact the APS team if interested to know more.</p>
</blockquote>
<h3 id="shared-idp">Shared IdP<a class="headerlink" href="#shared-idp" title="Permanent link">&para;</a></h3>
<p>Shared IdP is a new feature that allows you, as an API Provider, to leverage the SSO Gold-tier Keycloak cluster for managing Client Credentials, without having to deal with it directly.
The APS team have a custom realm on this Keycloak called <code>apigw</code> which the API Services Portal administers.</p>
<p>Token Issuers:</p>
<ul>
<li><a href="https://dev.loginproxy.gov.bc.ca/auth/realms/apigw">https://dev.loginproxy.gov.bc.ca/auth/realms/apigw</a></li>
<li><a href="https://test.loginproxy.gov.bc.ca/auth/realms/apigw">https://test.loginproxy.gov.bc.ca/auth/realms/apigw</a></li>
<li><a href="https://loginproxy.gov.bc.ca/auth/realms/apigw">https://loginproxy.gov.bc.ca/auth/realms/apigw</a></li>
</ul>
<p>To use it, perform the following steps:</p>
<h4 id="a-setup-the-authorization-profile">a) Setup the Authorization Profile<a class="headerlink" href="#a-setup-the-authorization-profile" title="Permanent link">&para;</a></h4>
<p>A credential with <code>CredentialIssuer.Admin</code> is required to update Authorization Profiles (<code>CredentialIssuer</code>).</p>
<p>Authorization Profiles can be setup either via the Portal or by using a Service Account with the Portal Directory API.</p>
<p>Update the below <code>CredentialIssuer</code> with the <code>name</code> and <code>description</code> that makes sense to you, and include the desired Roles setup for authorization.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CredentialIssuer</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Resource Server Example</span>
<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$NS</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Authorization Profile for protecting Ministry of XYZ</span>
<span class="nt">flow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">client-credentials</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
<span class="nt">authPlugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jwt-keycloak</span>
<span class="nt">clientAuthenticator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">client-secret</span>
<span class="nt">clientRoles</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">inheritFrom</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gold Shared IdP</span>
</code></pre></div></td></tr></table></div>
<h4 id="b-link-the-authorization-profile-to-the-product">b) Link the Authorization Profile to the Product<a class="headerlink" href="#b-link-the-authorization-profile-to-the-product" title="Permanent link">&para;</a></h4>
<p>Before making the API available on the Directory, the API should be configured with a plugin for protecting access. To do this, an API Provider can edit the Product details to select <code>Oauth2 Client Credential Flow</code> and the newly created Authorization Profile.</p>
<h4 id="c-update-your-gateway-configuration-with-the-plugin">c) Update your Gateway Configuration with the Plugin<a class="headerlink" href="#c-update-your-gateway-configuration-with-the-plugin" title="Permanent link">&para;</a></h4>
<p>Update your Gateway Configuration to include the <code>jwt-keycloak</code> plugin.</p>
<blockquote>
<p>HINT: When you configure the Product Environment, a <code>Plugin Template</code> will be displayed - this can be a starting point for protecting your API on the Gateway.</p>
</blockquote>
<p>Finally, from the Portal, <code>enable</code> the Environment to make it available on the API Directory.</p>
<h4 id="d-optional-configuration">d) Optional Configuration<a class="headerlink" href="#d-optional-configuration" title="Permanent link">&para;</a></h4>
<p><strong>Roles</strong></p>
<p>If you have Roles that you want to have controlled by the Portal, add them to the Client's <code>Roles</code>.</p>
<p>Update the <code>CredentialIssuer</code> record above with the <code>clientRoles</code> you want to manage.</p>
<h2 id="3-client-requesting-access">3. Client Requesting Access<a class="headerlink" href="#3-client-requesting-access" title="Permanent link">&para;</a></h2>
<p>Request access to the API via the API Services Portal and generate the credentials to be used below.</p>
<p>The Portal will use the credentials setup in the Authorization Profile, to create a disabled Client on the IdP (with any applicable Client Mappers) and return the credentials to the Requesting user.</p>
<h2 id="4-provider-approving-access">4. Provider Approving Access<a class="headerlink" href="#4-provider-approving-access" title="Permanent link">&para;</a></h2>
<p>An Access Manager reviews the access request, sets any additional controls, grants the relevant permissions (i.e./ scopes and roles), and approves. The Portal will enable the Client and apply the permissions on the IdP.</p>
<p>The Portal sends a notification to the Requester letting them know that API Access has been approved (or rejected).</p>
<h2 id="5-client-retrieving-the-access-token">5. Client Retrieving the Access Token<a class="headerlink" href="#5-client-retrieving-the-access-token" title="Permanent link">&para;</a></h2>
<p>Using the Credentials generated in step 3, the Requester calls the Token endpoint to get a new JWT token.</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code>export CID=&quot;&quot;
export CSC=&quot;&quot;
export URL=&quot;&quot;

curl $URL \
  -X POST -H &quot;Content-Type: application/x-www-form-urlencoded&quot; \
  -d client_id=$CID -d client_secret=$CSC \
  -d grant_type=client_credentials \
  -d scopes=openid
</code></pre></div></td></tr></table></div>
<h2 id="6-client-calling-the-api">6. Client Calling the API<a class="headerlink" href="#6-client-calling-the-api" title="Permanent link">&para;</a></h2>
<p>Extract the Access Token from the response, set it in a <code>TOK</code> environment variable, and call the API.</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>curl -v -H &quot;Authorization: Bearer $TOK&quot; \
  https://myservice.api.gov.bc.ca/v1/status
</code></pre></div></td></tr></table></div>
<p>The API Gateway's <code>jwt-keycloak</code> plugin will use the IdP's public keys to validate the token and depending on the plugin configuration, validate the scopes or roles.</p>
<h2 id="7-gateway-proxying-to-upstream">7. Gateway Proxying to Upstream<a class="headerlink" href="#7-gateway-proxying-to-upstream" title="Permanent link">&para;</a></h2>
<p>A technical, but important step in the integration is the Gateway proxying the request to the Upstream Service API and deciding on the different options for securing that interaction.</p>
<p>Options:</p>
<ul>
<li><code>Network Policy</code> : If the Services are co-located on the same Cluster as the Gateway's Data Plane, then native network policies can be used to protect the channel between the Gateway and the Upstream Service. This approach is used for Services running on the Openshift Silver cluster.</li>
</ul>
<ul>
<li><code>Kong Upstream JWT</code>: This plugin adds a signed JWT to the request headers so that the Upstream Service can verify that the request came specifically from the Gateway.</li>
</ul>
<ul>
<li><code>Client Certificates</code> : Client certificates (mTLS) provides a way for the Upstream Service to provide a secure channel from the Gateway and to verify that the request came specifically from the Gateway.</li>
</ul>
<ul>
<li><code>Firewall IP Restrictions</code> : This provides a low-level of protection by limiting the IPs to the ones of the Gateway Data Planes. Because the Data Planes are typically on shared infrastructure, this would still allow traffic from other tenants. This might be acceptable based on the type of data delivered by or to the Upstream Service.</li>
</ul>
<h2 id="variations">Variations<a class="headerlink" href="#variations" title="Permanent link">&para;</a></h2>
<h3 id="signed-jwt">Signed JWT<a class="headerlink" href="#signed-jwt" title="Permanent link">&para;</a></h3>
<p>The Authorization Profile <code>clientAuthenticator</code> was set to <code>client-secret</code> in this tutorial, but there is an alternate setup that can be used:</p>
<ul>
<li><code>client-jwt-jwks-url</code> (Signed JWT with JWKS URL or Certificate)</li>
</ul>
<p>In this scenario, when a Client is requesting access, they will be required to enter details about the client assertion certificates. The details can either be a public JWKS URL that holds the public key information for a key pair, or providing just the public key information. The information will be used in step 5 when retrieving the Bearer Token. For further details, you can see the specific examples <a href="../intro-signed-jwt/">Signed JWT w/ Hosted JWKS</a> or <a href="../intro-signed-jwt-pubkey/">Signed JWT w/ Certificate</a>.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../prom-query/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Query Kong Metrics Using Service Account" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Query Kong Metrics Using Service Account
              </div>
            </div>
          </a>
        
        
          
          <a href="../../portal-use-cases/access/" class="md-footer__link md-footer__link--next" aria-label="Next: 4. Request/Approve Access" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                4. Request/Approve Access
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "content.action.edit"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.efa0ade1.min.js"></script>
      
        <script src="../../search/main.js"></script>
      
    
  </body>
</html>